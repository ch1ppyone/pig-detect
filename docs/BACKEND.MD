# –î–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è —Å–∏—Å—Ç–µ–º—ã –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥–∞ –ø–æ–≤–µ–¥–µ–Ω–∏—è —Å–≤–∏–Ω–µ–π

–°–∏—Å—Ç–µ–º–∞ –ø–æ—Å—Ç—Ä–æ–µ–Ω–∞ –Ω–∞ Python —Å –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ–º PyTorch –¥–ª—è –º–æ–¥–µ–ª–µ–π –ò–ò, Flask –¥–ª—è –≤–µ–±-—Å–µ—Ä–≤–µ—Ä–∞ –∏ SocketIO –¥–ª—è —Ä–µ–∞–ª—å–Ω–æ–≥–æ –≤—Ä–µ–º–µ–Ω–∏. –û–Ω–∞ –¥–µ—Ç–µ–∫—Ç–∏—Ä—É–µ—Ç —Å–≤–∏–Ω–µ–π –Ω–∞ –≤–∏–¥–µ–æ/–∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è—Ö —Å –ø–æ–º–æ—â—å—é YOLO, –∫–ª–∞—Å—Å–∏—Ñ–∏—Ü–∏—Ä—É–µ—Ç –∏—Ö –ø–æ–∑—ã —Å –ø–æ–º–æ—â—å—é MobileNetV3Small –∏ –ø—Ä–µ–¥–æ—Å—Ç–∞–≤–ª—è–µ—Ç –≤–µ–±-–∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å –¥–ª—è –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥–∞, —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è –¥–∞–Ω–Ω—ã–º–∏ –∏ –æ–±—É—á–µ–Ω–∏—è –º–æ–¥–µ–ª–µ–π.

## 1. –°—Ç—Ä—É–∫—Ç—É—Ä–∞ –ø—Ä–æ–µ–∫—Ç–∞

–ü—Ä–æ–µ–∫—Ç –æ—Ä–≥–∞–Ω–∏–∑–æ–≤–∞–Ω –º–æ–¥—É–ª—å–Ω–æ. –í–æ—Ç –∫–ª—é—á–µ–≤—ã–µ –ø–∞–ø–∫–∏ –∏ —Ñ–∞–π–ª—ã:

- **app/**: –°–æ–¥–µ—Ä–∂–∏—Ç –ª–æ–≥–∏–∫—É –æ–±—Ä–∞–±–æ—Ç–∫–∏ –≤–∏–¥–µ–æ, –¥–µ—Ç–µ–∫—Ü–∏—é, –∫–ª–∞—Å—Å–∏—Ñ–∏–∫–∞—Ü–∏—é, –±–∞–∑—É –¥–∞–Ω–Ω—ã—Ö –∏ –º–∞—Ä—à—Ä—É—Ç—ã Flask.
  - `logging.py`: –ù–∞—Å—Ç—Ä–æ–π–∫–∞ –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏—è.
  - `video_processor.py`: –û–±—Ä–∞–±–æ—Ç–∫–∞ –∫–∞–¥—Ä–æ–≤ (–¥–µ—Ç–µ–∫—Ü–∏—è YOLO + –∫–ª–∞—Å—Å–∏—Ñ–∏–∫–∞—Ü–∏—è PyTorch).
  - `__init__.py`: –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è Flask –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è –∏ SocketIO.
  - `config.py`: –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è (–ø—É—Ç–∏, —É—Å—Ç—Ä–æ–π—Å—Ç–≤–æ, –ø—Ä–æ–≤–µ—Ä–∫–∏ hardware).
  - `detector.py`: –î–µ—Ç–µ–∫—Ç–æ—Ä –Ω–∞ –±–∞–∑–µ YOLO.
  - `db.py`: –ú–µ–Ω–µ–¥–∂–µ—Ä SQLite –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö –¥–ª—è —Å–æ—Å—Ç–æ—è–Ω–∏–π —Å–≤–∏–Ω–µ–π.
  - `routes.py`: –ú–∞—Ä—à—Ä—É—Ç—ã Flask –∏ –æ–±—Ä–∞–±–æ—Ç—á–∏–∫–∏ SocketIO (–≤–∏–¥–µ–æ-–ø–æ—Ç–æ–∫, –ª–æ–≥–∏, –æ–±—É—á–µ–Ω–∏–µ, —É–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –¥–∞–Ω–Ω—ã–º–∏).

- **train/**: –°–∫—Ä–∏–ø—Ç—ã –¥–ª—è –æ–±—É—á–µ–Ω–∏—è –º–æ–¥–µ–ª–µ–π.
  - `train_pt.py`: –ö–æ–Ω–≤–µ—Ä—Ç–∞—Ü–∏—è –¥–∞—Ç–∞—Å–µ—Ç–∞ –∏ –æ–±—É—á–µ–Ω–∏–µ MobileNetV3Small (PyTorch) –¥–ª—è –∫–ª–∞—Å—Å–∏—Ñ–∏–∫–∞—Ü–∏–∏ –ø–æ–∑.
  - `train_yolo.py`: –û–±—É—á–µ–Ω–∏–µ YOLO –¥–ª—è –¥–µ—Ç–µ–∫—Ü–∏–∏ —Å–≤–∏–Ω–µ–π.

- **run.py**: –¢–æ—á–∫–∞ –≤—Ö–æ–¥–∞ –¥–ª—è –∑–∞–ø—É—Å–∫–∞ Flask-—Å–µ—Ä–≤–µ—Ä–∞.

- **tests/**: Unit-—Ç–µ—Å—Ç—ã.
  - `test_db.py`: –¢–µ—Å—Ç—ã –¥–ª—è –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö.
  - `test_detector.py`: –¢–µ—Å—Ç—ã –¥–ª—è YOLO-–¥–µ—Ç–µ–∫—Ç–æ—Ä–∞.

- **–î—Ä—É–≥–∏–µ —Ñ–∞–π–ª—ã/–ø–∞–ø–∫–∏**:
  - `.env`: –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è –ø–µ—Ä–µ–º–µ–Ω–Ω—ã—Ö –æ–∫—Ä—É–∂–µ–Ω–∏—è (MODEL_PATH, PT_MODEL_PATH, DB_PATH –∏ —Ç.–¥.).
  - `pig_states.db`: SQLite –±–∞–∑–∞ –¥–∞–Ω–Ω—ã—Ö (—Å–æ–∑–¥–∞–µ—Ç—Å—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏).
  - `models/`: –î–∏—Ä–µ–∫—Ç–æ—Ä–∏—è –¥–ª—è –º–æ–¥–µ–ª–µ–π (yolo11m-seg.pt, pig_model.pth).
  - `train/dataset/`: –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –≥–µ–Ω–µ—Ä–∏—Ä—É–µ–º—ã–π –¥–∞—Ç–∞—Å–µ—Ç –¥–ª—è –æ–±—É—á–µ–Ω–∏—è –ø–æ–∑ (–ø–æ—Å–ª–µ `train_pt.py --convert`).
  - `train/object/pig/`: –î–∞—Ç–∞—Å–µ—Ç –¥–ª—è YOLO (images/ –∏ labels/ —Å .txt –∞–Ω–Ω–æ—Ç–∞—Ü–∏—è–º–∏).
  - `train/models/`: –î–∏—Ä–µ–∫—Ç–æ—Ä–∏—è –¥–ª—è –æ–±—É—á–µ–Ω–Ω—ã—Ö –º–æ–¥–µ–ª–µ–π YOLO (–Ω–∞–ø—Ä–∏–º–µ—Ä, yolo11m-seg-mod.pt), –∫–æ—Ç–æ—Ä—ã–µ –Ω—É–∂–Ω–æ –ø–µ—Ä–µ–Ω–æ—Å–∏—Ç—å –≤ `models/` –¥–ª—è –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è –≤ —Å–∏—Å—Ç–µ–º–µ.

- **test_data/**: –¢–µ—Å—Ç–æ–≤—ã–µ –≤–∏–¥–µ–æ/–∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è (pigs.mp4, 2.mp4 –∏ —Ç.–¥.), –∏—Å–ø–æ–ª—å–∑—É–µ–º—ã–µ –¥–ª—è –æ–±—Ä–∞–±–æ—Ç–∫–∏.

–í—Ä–µ–º–µ–Ω–Ω—ã–µ –ø–∞–ø–∫–∏ (–Ω–∞–ø—Ä–∏–º–µ—Ä, `temp/` –æ—Ç –æ–±—É—á–µ–Ω–∏—è YOLO) –≥–µ–Ω–µ—Ä–∏—Ä—É—é—Ç—Å—è –∏ —É–¥–∞–ª—è—é—Ç—Å—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏.

## 2. –ù–µ–æ–±—Ö–æ–¥–∏–º—ã–µ –±–∏–±–ª–∏–æ—Ç–µ–∫–∏ –¥–ª—è —É—Å—Ç–∞–Ω–æ–≤–∫–∏

–°–∏—Å—Ç–µ–º–∞ —Ç—Ä–µ–±—É–µ—Ç Python 3.11+. –£—Å—Ç–∞–Ω–æ–≤–∏—Ç–µ –±–∏–±–ª–∏–æ—Ç–µ–∫–∏ —á–µ—Ä–µ–∑ `pip`. –†–µ–∫–æ–º–µ–Ω–¥—É–µ—Ç—Å—è —Å–æ–∑–¥–∞—Ç—å –≤–∏—Ä—Ç—É–∞–ª—å–Ω–æ–µ –æ–∫—Ä—É–∂–µ–Ω–∏–µ (`python -m venv env; source env/bin/activate` –Ω–∞ Unix –∏–ª–∏ `env\Scripts\activate` –Ω–∞ Windows).

–°–ø–∏—Å–æ–∫ –±–∏–±–ª–∏–æ—Ç–µ–∫:
- flask
- flask-socketio
- ultralytics
- torch
- torchvision
- opencv-python
- numpy
- python-dotenv
- tqdm
- pyyaml

–£—Å—Ç–∞–Ω–æ–≤–∫–∞:
```bash
pip install flask flask-socketio ultralytics torch torchvision opencv-python numpy python-dotenv tqdm pyyaml
```

–î–ª—è GPU: –£—Å—Ç–∞–Ω–æ–≤–∏—Ç–µ PyTorch —Å CUDA (—Å–º. —Ä–∞–∑–¥–µ–ª 7.1).

## 3. –û–ø–∏—Å–∞–Ω–∏–µ —Ñ–∞–π–ª–æ–≤, –º–µ—Ç–æ–¥–æ–≤ –∏ —Ñ—É–Ω–∫—Ü–∏–æ–Ω–∞–ª–∞

### app/logging.py
–ù–∞—Å—Ç—Ä–∞–∏–≤–∞–µ—Ç –≥–ª–æ–±–∞–ª—å–Ω—ã–π –ª–æ–≥–≥–µ—Ä –¥–ª—è –≤—ã–≤–æ–¥–∞ —Å–æ–æ–±—â–µ–Ω–∏–π –≤ –∫–æ–Ω—Å–æ–ª—å —Å –≤—Ä–µ–º–µ–Ω–Ω—ã–º–∏ –º–µ—Ç–∫–∞–º–∏ –∏ —É—Ä–æ–≤–Ω—è–º–∏ (INFO, WARNING, ERROR). –õ–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –≤–æ –≤—Å–µ—Ö –º–æ–¥—É–ª—è—Ö –¥–ª—è –æ—Ç—Å–ª–µ–∂–∏–≤–∞–Ω–∏—è —Å–æ–±—ã—Ç–∏–π, –æ—à–∏–±–æ–∫ –∏ –ø—Ä–æ–≥—Ä–µ—Å—Å–∞.
- **–ü—Ä–æ—Ü–µ—Å—Å**: –í—ã–∑—ã–≤–∞–µ—Ç `logging.basicConfig` —Å —Ñ–æ—Ä–º–∞—Ç–æ–º `%(asctime)s - %(levelname)s - %(message)s`. –°–æ–∑–¥–∞–µ—Ç –ª–æ–≥–≥–µ—Ä `logger = logging.getLogger(__name__)`, –∫–æ—Ç–æ—Ä—ã–π –∏–º–ø–æ—Ä—Ç–∏—Ä—É–µ—Ç—Å—è –≤ –¥—Ä—É–≥–∏–µ —Ñ–∞–π–ª—ã –¥–ª—è –≤—ã–∑–æ–≤–∞ `logger.info()`, `logger.warning()` –∏ —Ç.–¥.

### app/video_processor.py
–ö–ª–∞—Å—Å VideoProcessor –æ–±—Ä–∞–±–∞—Ç—ã–≤–∞–µ—Ç –≤–∏–¥–µ–æ–ø–æ—Ç–æ–∫ –∏–ª–∏ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–µ: –∑–∞–≥—Ä—É–∂–∞–µ—Ç –≤–∏–¥–µ–æ, –≤—ã–ø–æ–ª–Ω—è–µ—Ç –¥–µ—Ç–µ–∫—Ü–∏—é —Å–≤–∏–Ω–µ–π YOLO, –∫–ª–∞—Å—Å–∏—Ñ–∏—Ü–∏—Ä—É–µ—Ç –∏—Ö –ø–æ–∑—ã PyTorch, –ª–æ–≥–∏—Ä—É–µ—Ç —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ã –∏ —É–ø—Ä–∞–≤–ª—è–µ—Ç –ø–æ—Ç–æ–∫–∞–º–∏.
- **__init__(model_path, device, video_path, tracker_config, pt_model_path, db_path)**: 
  - –ü—Ä–æ–≤–µ—Ä—è–µ—Ç —Å—É—â–µ—Å—Ç–≤–æ–≤–∞–Ω–∏–µ —Ñ–∞–π–ª–æ–≤ (–≤–∏–¥–µ–æ, –º–æ–¥–µ–ª–∏).
  - –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä—É–µ—Ç YOLO-–¥–µ—Ç–µ–∫—Ç–æ—Ä (`Detector`).
  - –ó–∞–≥—Ä—É–∂–∞–µ—Ç PyTorch –º–æ–¥–µ–ª—å MobileNetV3Small, –ø–µ—Ä–µ–≤–æ–¥–∏—Ç –≤ —Ä–µ–∂–∏–º –æ—Ü–µ–Ω–∫–∏ (`eval()`) –∏ –Ω–∞ —É—Å—Ç—Ä–æ–π—Å—Ç–≤–æ (GPU/CPU).
  - –ù–∞—Å—Ç—Ä–∞–∏–≤–∞–µ—Ç —Ç—Ä–∞–Ω—Å—Ñ–æ—Ä–º–∞—Ü–∏–∏ (`transforms.Compose`) –¥–ª—è –Ω–æ—Ä–º–∞–ª–∏–∑–∞—Ü–∏–∏ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–π –≤ –¥–∏–∞–ø–∞–∑–æ–Ω [-1, 1].
  - –ó–∞–≥—Ä—É–∂–∞–µ—Ç –∫–ª–∞—Å—Å—ã –ø–æ–∑ –∏–∑ –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö.
  - –û—Ç–∫—Ä—ã–≤–∞–µ—Ç –≤–∏–¥–µ–æ (`cv2.VideoCapture`) –∏–ª–∏ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–µ (`cv2.imread`), —É—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ—Ç –∑–∞–¥–µ—Ä–∂–∫—É –∫–∞–¥—Ä–æ–≤.
  - –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä—É–µ—Ç –ª–æ–∫–µ—Ä—ã, –ª–æ–≥–∏ –∏ —Å–ª–æ–≤–∞—Ä–∏ –¥–ª—è —Å–æ—Å—Ç–æ—è–Ω–∏–π.
- **reset_video()**: –ó–∞–∫—Ä—ã–≤–∞–µ—Ç –∏ –ø–µ—Ä–µ–æ—Ç–∫—Ä—ã–≤–∞–µ—Ç –≤–∏–¥–µ–æ –ø—Ä–∏ –æ—à–∏–±–∫–µ —á—Ç–µ–Ω–∏—è –∫–∞–¥—Ä–∞, –∏—Å–ø–æ–ª—å–∑—É—è `cv2.VideoCapture`.
- **preprocess_crop(roi)**: –ü—Ä–µ–æ–±—Ä–∞–∑—É–µ—Ç –æ–±–ª–∞—Å—Ç—å –∏–Ω—Ç–µ—Ä–µ—Å–∞ (ROI) –≤ —Ç–µ–Ω–∑–æ—Ä: –∫–æ–Ω–≤–µ—Ä—Ç–∏—Ä—É–µ—Ç BGR –≤ RGB (`cv2.cvtColor`), —Ä–µ—Å–∞–π–∑–∏—Ç –¥–æ 224x224 (`cv2.resize`), –ø—Ä–∏–º–µ–Ω—è–µ—Ç —Ç—Ä–∞–Ω—Å—Ñ–æ—Ä–º–∞—Ü–∏–∏ (`ToTensor`, `Normalize`).
- **classify_pig_states(frame, bboxes)**: 
  - –§–∏–ª—å—Ç—Ä—É–µ—Ç –º–∞–ª–µ–Ω—å–∫–∏–µ/–ø—É—Å—Ç—ã–µ bbox.
  - –°–æ–∑–¥–∞–µ—Ç –∫—Ä–æ–ø—ã –∏–∑ frame, –ø—Ä–µ–æ–±—Ä–∞–∑—É–µ—Ç –≤ —Ç–µ–Ω–∑–æ—Ä—ã.
  - –°—Ç—ç–∫–∞–µ—Ç —Ç–µ–Ω–∑–æ—Ä—ã –≤ –±–∞—Ç—á (`torch.stack`), –≤—ã–ø–æ–ª–Ω—è–µ—Ç –∏–Ω—Ñ–µ—Ä–µ–Ω—Å (`model(crops)`).
  - –í–æ–∑–≤—Ä–∞—â–∞–µ—Ç –∏–Ω–¥–µ–∫—Å—ã —Å–æ—Å—Ç–æ—è–Ω–∏–π (`torch.argmax(preds, dim=1)`).
- **process_frame()**: 
  - –ß–∏—Ç–∞–µ—Ç –∫–∞–¥—Ä –∏–∑ –≤–∏–¥–µ–æ/–∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è.
  - –í—ã–ø–æ–ª–Ω—è–µ—Ç –¥–µ—Ç–µ–∫—Ü–∏—é (`detector.detect_and_track`), —Ä–∏—Å—É–µ—Ç bbox/–º–∞—Å–∫–∏ (`results[0].plot`).
  - –ö–ª–∞—Å—Å–∏—Ñ–∏—Ü–∏—Ä—É–µ—Ç –ø–æ–∑—ã, –æ–±–Ω–æ–≤–ª—è–µ—Ç —Å–ª–æ–≤–∞—Ä–∏ —Å–æ—Å—Ç–æ—è–Ω–∏–π –∏ –¥–ª–∏—Ç–µ–ª—å–Ω–æ—Å—Ç–µ–π, –¥–æ–±–∞–≤–ª—è–µ—Ç –∑–∞–ø–∏—Å–∏ –≤ –ª–æ–≥–∏.
  - –õ–æ–≥–∏—Ä—É–µ—Ç –≤—Ä–µ–º—è –æ–±—Ä–∞–±–æ—Ç–∫–∏.
- **next_frame()**: –í—ã–∑—ã–≤–∞–µ—Ç `process_frame` –¥–ª—è SocketIO.
- **release()**: –û—Å–≤–æ–±–æ–∂–¥–∞–µ—Ç —Ä–µ—Å—É—Ä—Å—ã (–∑–∞–∫—Ä—ã–≤–∞–µ—Ç –≤–∏–¥–µ–æ, –±–∞–∑—É –¥–∞–Ω–Ω—ã—Ö).
- **__del__()**: –î–µ—Å—Ç—Ä—É–∫—Ç–æ—Ä –¥–ª—è –æ—á–∏—Å—Ç–∫–∏ –ø—Ä–∏ —É–¥–∞–ª–µ–Ω–∏–∏ –æ–±—ä–µ–∫—Ç–∞.

### app/__init__.py
–ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä—É–µ—Ç Flask-–ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ –∏ SocketIO, —Å–æ–∑–¥–∞–µ—Ç –≥–ª–æ–±–∞–ª—å–Ω—ã–µ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –¥–ª—è –æ—á–µ—Ä–µ–¥–µ–π –∏ –∑–∞–¥–∞—á.
- **create_app(processor=None)**: 
  - –ü—Ä–æ–≤–µ—Ä—è–µ—Ç hardware (`check_hardware`).
  - –°–æ–∑–¥–∞–µ—Ç VideoProcessor, –µ—Å–ª–∏ –Ω–µ –ø–µ—Ä–µ–¥–∞–Ω.
  - –ò–º–ø–æ—Ä—Ç–∏—Ä—É–µ—Ç –º–∞—Ä—à—Ä—É—Ç—ã.

### app/config.py
–ó–∞–≥—Ä—É–∂–∞–µ—Ç –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—é –∏–∑ .env, –ø–∞—Ä—Å–∏—Ç –∞—Ä–≥—É–º–µ–Ω—Ç—ã, –ø—Ä–æ–≤–µ—Ä—è–µ—Ç —É—Å—Ç—Ä–æ–π—Å—Ç–≤–æ.
- **check_hardware()**: –õ–æ–≥–∏—Ä—É–µ—Ç –≤–µ—Ä—Å–∏–∏ PyTorch, –¥–æ—Å—Ç—É–ø–Ω–æ—Å—Ç—å CUDA –∏ —É—Å—Ç—Ä–æ–π—Å—Ç–≤–æ.
- **create_video_processor(video_path=VIDEO_PATH)**: –°–æ–∑–¥–∞–µ—Ç —ç–∫–∑–µ–º–ø–ª—è—Ä VideoProcessor —Å –ø–∞—Ä–∞–º–µ—Ç—Ä–∞–º–∏ –∏–∑ .env.
- **get_color_for_track(track_id)**: –ì–µ–Ω–µ—Ä–∏—Ä—É–µ—Ç —Å–ª—É—á–∞–π–Ω—ã–π —Ü–≤–µ—Ç –¥–ª—è —Ç—Ä–µ–∫–∞ –ø–æ seed.
- **is_safe_filename(filename)**: –ü—Ä–æ–≤–µ—Ä—è–µ—Ç –∏–º—è —Ñ–∞–π–ª–∞ –Ω–∞ –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å (—Ä–µ–≥—É–ª—è—Ä–Ω–æ–µ –≤—ã—Ä–∞–∂–µ–Ω–∏–µ).

### app/detector.py
–ö–ª–∞—Å—Å Detector –¥–ª—è YOLO-–¥–µ—Ç–µ–∫—Ü–∏–∏.
- **__init__(model_path, device, tracker_config)**: 
  - –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä—É–µ—Ç YOLO (`YOLO(model_path)`), –ø–µ—Ä–µ–≤–æ–¥–∏—Ç –Ω–∞ —É—Å—Ç—Ä–æ–π—Å—Ç–≤–æ.
  - –¢—Ä–µ–∫–µ—Ä –æ—Ç–∫–ª—é—á–µ–Ω (tracker_available=False).
- **detect_and_track(frame)**: –ü—Ä–µ–¥—Å–∫–∞–∑—ã–≤–∞–µ—Ç –Ω–∞ –∫–∞–¥—Ä–µ (`detector.predict`), –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ã, –ª–æ–≥–∏—Ä—É–µ—Ç –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ –æ–±—ä–µ–∫—Ç–æ–≤.

### app/db.py
–ö–ª–∞—Å—Å DatabaseManager –¥–ª—è —Ä–∞–±–æ—Ç—ã —Å SQLite –±–∞–∑–æ–π —Å–æ—Å—Ç–æ—è–Ω–∏–π —Å–≤–∏–Ω–µ–π.
- **__init__(db_path, yolo_model=None)**: –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä—É–µ—Ç –±–∞–∑—É, –≤—ã–∑—ã–≤–∞–µ—Ç `init_db`.
- **init_db()**: –°–æ–∑–¥–∞–µ—Ç —Ç–∞–±–ª–∏—Ü—É states, –µ—Å–ª–∏ –Ω–µ—Ç, –∑–∞–ø–æ–ª–Ω—è–µ—Ç –Ω–∞—á–∞–ª—å–Ω—ã–º–∏ —Å–æ—Å—Ç–æ—è–Ω–∏—è–º–∏ (Feeding –∏ —Ç.–¥.).
- **get_states()**: –ö—ç—à–∏—Ä—É–µ—Ç –∏ –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç —Å–ª–æ–≤–∞—Ä—å —Å–æ—Å—Ç–æ—è–Ω–∏–π (code: description).
- **load_class_names()**: –í–æ–∑–≤—Ä–∞—â–∞–µ—Ç —Å–ø–∏—Å–æ–∫ –∫–æ–¥–æ–≤ —Å–æ—Å—Ç–æ—è–Ω–∏–π.
- **add_state(code, desc)**: –î–æ–±–∞–≤–ª—è–µ—Ç —Å–æ—Å—Ç–æ—è–Ω–∏–µ –≤ –±–∞–∑—É –∏ —Å–æ–∑–¥–∞–µ—Ç –ø–∞–ø–∫—É –≤ `train/states/`.
- **update_state(old, new, desc)**: –û–±–Ω–æ–≤–ª—è–µ—Ç —Å–æ—Å—Ç–æ—è–Ω–∏–µ, –ø–µ—Ä–µ–∏–º–µ–Ω–æ–≤—ã–≤–∞–µ—Ç –ø–∞–ø–∫—É –µ—Å–ª–∏ –Ω—É–∂–Ω–æ.
- **delete_state(code)**: –£–¥–∞–ª—è–µ—Ç —Å–æ—Å—Ç–æ—è–Ω–∏–µ –∏–∑ –±–∞–∑—ã –∏ –ø–∞–ø–∫—É —Å —Ñ–∞–π–ª–∞–º–∏.
- **close()**: –û—á–∏—â–∞–µ—Ç –∫—ç—à.

### app/routes.py
–û–ø—Ä–µ–¥–µ–ª—è–µ—Ç –º–∞—Ä—à—Ä—É—Ç—ã Flask –∏ –æ–±—Ä–∞–±–æ—Ç—á–∏–∫–∏ SocketIO.
- **frame_process_thread(client_id)**: –ü–æ—Ç–æ–∫: –æ–±—Ä–∞–±–∞—Ç—ã–≤–∞–µ—Ç –∫–∞–¥—Ä—ã –∏–∑ –ø—Ä–æ—Ü–µ—Å—Å–æ—Ä–∞, –∫–æ–¥–∏—Ä—É–µ—Ç –≤ JPEG (`cv2.imencode`), –¥–æ–±–∞–≤–ª—è–µ—Ç –≤ –æ—á–µ—Ä–µ–¥—å.
- **frame_emit_thread()**: –ü–æ—Ç–æ–∫: –û—Ç–ø—Ä–∞–≤–ª—è–µ—Ç –∫–∞–¥—Ä—ã –∫–ª–∏–µ–Ω—Ç–∞–º —á–µ—Ä–µ–∑ SocketIO (`video_frame`).
- **data_emit_thread(client_id)**: –ü–æ—Ç–æ–∫: –û—Ç–ø—Ä–∞–≤–ª—è–µ—Ç –ª–æ–≥–∏ –∫–ª–∏–µ–Ω—Ç–∞–º (`log_update`).
- **@app.route("/")**: –†–µ–Ω–¥–µ—Ä–∏—Ç `index.html` —Å –∏—Å—Ç–æ—á–Ω–∏–∫–∞–º–∏ –≤–∏–¥–µ–æ.
- **@app.route("/get_states")**: –í–æ–∑–≤—Ä–∞—â–∞–µ—Ç JSON —Å–æ—Å—Ç–æ—è–Ω–∏–π –∏–∑ –±–∞–∑—ã.
- **@app.route("/get_videos/<state_code>")**: –í–æ–∑–≤—Ä–∞—â–∞–µ—Ç –ø–∞–≥–∏–Ω–∏—Ä–æ–≤–∞–Ω–Ω—ã–π —Å–ø–∏—Å–æ–∫ —Ñ–∞–π–ª–æ–≤ –¥–∞—Ç–∞—Å–µ—Ç–∞ –¥–ª—è —Å–æ—Å—Ç–æ—è–Ω–∏—è.
- **@app.route("/train/dataset/<state_code>/<filename>")**: –û—Ç–ø—Ä–∞–≤–ª—è–µ—Ç —Ñ–∞–π–ª –¥–∞—Ç–∞—Å–µ—Ç–∞.
- **@app.route("/upload_video/<state_code>", methods=["POST"])**: –ó–∞–≥—Ä—É–∂–∞–µ—Ç —Ñ–∞–π–ª –≤ –¥–∞—Ç–∞—Å–µ—Ç, –ø—Ä–æ–≤–µ—Ä—è–µ—Ç —Ñ–æ—Ä–º–∞—Ç –∏ –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å.
- **@app.route("/delete_video/<state_code>", methods=["POST"])**: –£–¥–∞–ª—è–µ—Ç —Ñ–∞–π–ª –∏–∑ –¥–∞—Ç–∞—Å–µ—Ç–∞.
- **@app.route("/train_model", methods=["POST"])**: –ó–∞–ø—É—Å–∫–∞–µ—Ç –ø–æ—Ç–æ–∫ –æ–±—É—á–µ–Ω–∏—è (`train_pt.py`), –æ—Ç–ø—Ä–∞–≤–ª—è–µ—Ç –ª–æ–≥–∏ —á–µ—Ä–µ–∑ SocketIO.
- **@socketio.on('connect')**: –°–æ–∑–¥–∞–µ—Ç –ø—Ä–æ—Ü–µ—Å—Å–æ—Ä –¥–ª—è –∫–ª–∏–µ–Ω—Ç–∞, –∑–∞–ø—É—Å–∫–∞–µ—Ç –ø–æ—Ç–æ–∫–∏.
- **@socketio.on('disconnect')**: –û—Å–≤–æ–±–æ–∂–¥–∞–µ—Ç —Ä–µ—Å—É—Ä—Å—ã.
- **@socketio.on('set_video_source')**: –ú–µ–Ω—è–µ—Ç –∏—Å—Ç–æ—á–Ω–∏–∫ –≤–∏–¥–µ–æ –¥–ª—è –∫–ª–∏–µ–Ω—Ç–∞.
- **@socketio.on('request_logs')**: –û—Ç–ø—Ä–∞–≤–ª—è–µ—Ç –ª–æ–≥–∏.
- **@socketio.on('request_chart_data')**: –û—Ç–ø—Ä–∞–≤–ª—è–µ—Ç –¥–∞–Ω–Ω—ã–µ –¥–ª—è –≥—Ä–∞—Ñ–∏–∫–æ–≤.
- **@socketio.on('add_state')**: –î–æ–±–∞–≤–ª—è–µ—Ç —Å–æ—Å—Ç–æ—è–Ω–∏–µ –≤ –±–∞–∑—É.
- **@socketio.on('update_state')**: –û–±–Ω–æ–≤–ª—è–µ—Ç —Å–æ—Å—Ç–æ—è–Ω–∏–µ.
- **@socketio.on('delete_state')**: –£–¥–∞–ª—è–µ—Ç —Å–æ—Å—Ç–æ—è–Ω–∏–µ.

### train/train_pt.py
–°–∫—Ä–∏–ø—Ç –¥–ª—è –∫–æ–Ω–≤–µ—Ä—Ç–∞—Ü–∏–∏ YOLO-–¥–∞—Ç–∞—Å–µ—Ç–∞ –∏ –æ–±—É—á–µ–Ω–∏—è MobileNetV3Small –Ω–∞ PyTorch.
- **convert_yolo_to_tf(img_dir, label_dir, out_dir, db)**: –ö–æ–Ω–≤–µ—Ä—Ç–∏—Ä—É–µ—Ç YOLO-–ª–µ–π–±–ª—ã –≤ –ø–∞–ø–∫–∏ —Å –∫—Ä–æ–ø–∞–º–∏ –ø–æ –∫–ª–∞—Å—Å–∞–º –ø–æ–∑, –∏—Å–ø–æ–ª—å–∑—É—è bbox –¥–ª—è –≤—ã—Ä–µ–∑–∞–Ω–∏—è ROI.
- **train_model(db)**: 
  - –ó–∞–≥—Ä—É–∂–∞–µ—Ç –¥–∞—Ç–∞—Å–µ—Ç (`ImageFolder`, `random_split`).
  - –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä—É–µ—Ç –º–æ–¥–µ–ª—å (`mobilenet_v3_small`), –∑–∞–º–µ–Ω—è–µ—Ç –∫–ª–∞—Å—Å–∏—Ñ–∏–∫–∞—Ç–æ—Ä.
  - –û–±—É—á–∞–µ—Ç –≤ 2 —ç—Ç–∞–ø–∞: –≤–µ—Ä—Ö—É—à–∫–∞, –∑–∞—Ç–µ–º fine-tuning –ø–æ—Å–ª–µ–¥–Ω–∏—Ö —Å–ª–æ–µ–≤, —Å –ø—Ä–æ–≥—Ä–µ—Å—Å-–±–∞—Ä–∞–º–∏ (`tqdm`), –ø–æ—Ç–µ—Ä—è–º–∏ –∏ —Ç–æ—á–Ω–æ—Å—Ç—å—é.
  - –°–æ—Ö—Ä–∞–Ω—è–µ—Ç –º–æ–¥–µ–ª—å (`torch.save`).

### train/train_yolo.py
–°–∫—Ä–∏–ø—Ç –¥–ª—è –æ–±—É—á–µ–Ω–∏—è YOLO –Ω–∞ –¥–µ—Ç–µ–∫—Ü–∏–∏ —Å–≤–∏–Ω–µ–π.
- **check_gpu()**: –ü—Ä–æ–≤–µ—Ä—è–µ—Ç CUDA –∏ –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç —É—Å—Ç—Ä–æ–π—Å—Ç–≤–æ.
- **create_default_yaml(dataset_path, class_name)**: –°–æ–∑–¥–∞–µ—Ç `data.yaml` —Å –ø—É—Ç—è–º–∏ –∏ –∫–ª–∞—Å—Å–∞–º–∏.
- **update_yaml_paths(data_yaml_path, base_path)**: –ê–±—Å–æ–ª—é—Ç–∏–∑–∏—Ä—É–µ—Ç –ø—É—Ç–∏ –≤ YAML.
- **validate_dataset(dataset_path)**: –ü—Ä–æ–≤–µ—Ä—è–µ—Ç —Å—Ç—Ä—É–∫—Ç—É—Ä—É –¥–∞—Ç–∞—Å–µ—Ç–∞.
- **train_model(dataset_path, output_dir, class_name, epochs, img_size, batch_size)**: 
  - –í–∞–ª–∏–¥–∏—Ä—É–µ—Ç –¥–∞—Ç–∞—Å–µ—Ç, –æ–±–Ω–æ–≤–ª—è–µ—Ç YAML.
  - –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä—É–µ—Ç YOLO, –æ–±—É—á–∞–µ—Ç (`model.train`), —Å–æ—Ö—Ä–∞–Ω—è–µ—Ç –ª—É—á—à—É—é –º–æ–¥–µ–ª—å (—Å —Å—É—Ñ—Ñ–∏–∫—Å–æ–º -mod.pt –≤ `train/models/`).

### run.py
–ó–∞–ø—É—Å–∫–∞–µ—Ç Flask-—Å–µ—Ä–≤–µ—Ä.
- **parse_args()**: –ü–∞—Ä—Å–∏—Ç –∞—Ä–≥—É–º–µ–Ω—Ç—ã –∫–æ–º–∞–Ω–¥–Ω–æ–π —Å—Ç—Ä–æ–∫–∏ (device, model, video –∏ —Ç.–¥.).
- **main**: –ü—Ä–æ–≤–µ—Ä—è–µ—Ç hardware, —Å–æ–∑–¥–∞–µ—Ç –ø—Ä–æ—Ü–µ—Å—Å–æ—Ä, –∑–∞–ø—É—Å–∫–∞–µ—Ç Flask –Ω–∞ 0.0.0.0:9001.

## 4. –ú–æ–¥–µ–ª–∏, –∏—Å–ø–æ–ª—å–∑—É–µ–º—ã–µ –≤ —Å–∏—Å—Ç–µ–º–µ

- **YOLO11m-seg (–∏–∑ Ultralytics)**: –û—Å–Ω–æ–≤–Ω–∞—è –º–æ–¥–µ–ª—å –¥–ª—è –∏–Ω—Å—Ç–∞–Ω—Å-—Å–µ–≥–º–µ–Ω—Ç–∞—Ü–∏–∏ —Å–≤–∏–Ω–µ–π (–¥–µ—Ç–µ–∫—Ü–∏—è bbox + –º–∞—Å–∫–∏). –í—ã–±—Ä–∞–Ω–∞ –∑–∞ —Å–∫–æ—Ä–æ—Å—Ç—å (—Ä–µ–∞–ª—å–Ω–æ–µ –≤—Ä–µ–º—è –Ω–∞ GPU, ~15ms/–∫–∞–¥—Ä), —Ç–æ—á–Ω–æ—Å—Ç—å (mAP >80% –Ω–∞ COCO) –∏ –ø—Ä–æ—Å—Ç–æ—Ç—É (–≥–æ—Ç–æ–≤—ã–π API). –°—É—Ñ—Ñ–∏–∫—Å `-seg` –æ–±–µ—Å–ø–µ—á–∏–≤–∞–µ—Ç —Ç–æ—á–Ω–æ–µ –≤—ã–¥–µ–ª–µ–Ω–∏–µ –∫–æ–Ω—Ç—É—Ä–æ–≤ —Å–≤–∏–Ω–µ–π, —á—Ç–æ –ø–æ–ª–µ–∑–Ω–æ –¥–ª—è –∞–Ω–∞–ª–∏–∑–∞ —Ñ–æ—Ä–º –∏–ª–∏ –∏—Å–∫–ª—é—á–µ–Ω–∏—è —Ñ–æ–Ω–∞. –û—Ç–ª–∏—á–∞–µ—Ç—Å—è –æ—Ç –æ–±—ã—á–Ω–æ–π YOLO11m (–±–µ–∑ -seg): –æ–±—ã—á–Ω–∞—è –¥–∞–µ—Ç —Ç–æ–ª—å–∫–æ bbox –∏ –∫–ª–∞—Å—Å—ã, –±–µ–∑ –ø–∏–∫—Å–µ–ª—å–Ω—ã—Ö –º–∞—Å–æ–∫; —Å–µ–≥–º–µ–Ω—Ç–∞—Ü–∏–æ–Ω–Ω–∞—è –¥–æ–±–∞–≤–ª—è–µ—Ç –º–∞—Å–∫–∏ –¥–ª—è –∫–∞–∂–¥–æ–≥–æ –æ–±—ä–µ–∫—Ç–∞, —á—Ç–æ —É–≤–µ–ª–∏—á–∏–≤–∞–µ—Ç —Ç–æ—á–Ω–æ—Å—Ç—å –≤ –∑–∞–¥–∞—á–∞—Ö –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥–∞ –ø–æ–≤–µ–¥–µ–Ω–∏—è (–Ω–∞–ø—Ä–∏–º–µ—Ä, —Ä–∞–∑–ª–∏—á–µ–Ω–∏–µ –ø–æ–∑ –ø–æ —Å–∏–ª—É—ç—Ç—É). –ü—Ä–µ–¥–æ–±—É—á–µ–Ω–Ω–∞—è –Ω–∞ COCO, –¥–æ–æ–±—É—á–∞–µ—Ç—Å—è –Ω–∞ –¥–∞—Ç–∞—Å–µ—Ç–µ —Å–≤–∏–Ω–µ–π –¥–ª—è –∫–ª–∞—Å—Å–∞ "pig".

- **MobileNetV3Small (–∏–∑ torchvision/PyTorch)**: –î–ª—è –∫–ª–∞—Å—Å–∏—Ñ–∏–∫–∞—Ü–∏–∏ –ø–æ–∑ —Å–≤–∏–Ω–µ–π (Feeding, Lateral_Lying –∏ —Ç.–¥.). –í—ã–±—Ä–∞–Ω–∞ –∑–∞ –ª–µ–≥–∫–æ–≤–µ—Å–Ω–æ—Å—Ç—å (~5M –ø–∞—Ä–∞–º–µ—Ç—Ä–æ–≤, ~2-4MB –º–æ–¥–µ–ª—å), —Å–∫–æ—Ä–æ—Å—Ç—å –∏–Ω—Ñ–µ—Ä–µ–Ω—Å–∞ (~10ms/bbox) –∏ —Ç–æ—á–Ω–æ—Å—Ç—å –Ω–∞ ImageNet (>70%). –ü–æ–¥—Ö–æ–¥–∏—Ç –¥–ª—è —Å–µ—Ä–≤–µ—Ä–∞. –ü—Ä–µ–¥–æ–±—É—á–µ–Ω–Ω–∞—è –Ω–∞ ImageNet, –¥–æ–æ–±—É—á–∞–µ—Ç—Å—è –Ω–∞ –∫—Ä–æ–ø–∞—Ö —Å–≤–∏–Ω–µ–π.

–ú–æ–¥–µ–ª–∏ —Ö—Ä–∞–Ω—è—Ç—Å—è –≤ `models/`, –ø—É—Ç–∏ –≤ `.env`. –ü–æ—Å–ª–µ –æ–±—É—á–µ–Ω–∏—è YOLO –º–æ–¥–µ–ª—å —Å–æ—Ö—Ä–∞–Ω—è–µ—Ç—Å—è –≤ `train/models/` (—Å —Å—É—Ñ—Ñ–∏–∫—Å–æ–º -mod.pt) –∏ —Ç—Ä–µ–±—É–µ—Ç –ø–µ—Ä–µ–Ω–æ—Å–∞ –≤ `models/` –¥–ª—è –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è.

## 5. –¢—Ä–µ–±–æ–≤–∞–Ω–∏—è –∫ –¥–∞—Ç–∞—Å–µ—Ç—É

- **–î–ª—è YOLO (–¥–µ—Ç–µ–∫—Ü–∏—è —Å–≤–∏–Ω–µ–π, `train/object/pig/`)**:
  - –°—Ç—Ä—É–∫—Ç—É—Ä–∞: `train/images/` (–∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è .jpg/.png), `train/labels/` (.txt —Ñ–∞–π–ª—ã –≤ —Ñ–æ—Ä–º–∞—Ç–µ YOLO: class_id x_center y_center width height, class_id=0 –¥–ª—è "pig").
  - –ê–Ω–∞–ª–æ–≥–∏—á–Ω–æ –¥–ª—è `val/` (–≤–∞–ª–∏–¥–∞—Ü–∏—è).
  - –¢—Ä–µ–±–æ–≤–∞–Ω–∏—è: >500 –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–π –Ω–∞ split, —Ä–∞–∑–Ω–æ–æ–±—Ä–∞–∑–∏–µ (—Ä–∞–∑–Ω—ã–µ —É–≥–ª—ã, –æ—Å–≤–µ—â–µ–Ω–∏–µ), –∞–Ω–Ω–æ—Ç–∞—Ü–∏–∏ bbox (–∏—Å–ø–æ–ª—å–∑—É–π—Ç–µ LabelImg –∏–ª–∏ Roboflow).
  - –†–∞–∑–º–µ—Ä: 640x640 —Ä–µ–∫–æ–º–µ–Ω–¥—É–µ–º—ã–π, –Ω–æ –º–æ–¥–µ–ª—å –∞–¥–∞–ø—Ç–∏—Ä—É–µ—Ç—Å—è.

- **–î–ª—è MobileNetV3Small (–∫–ª–∞—Å—Å–∏—Ñ–∏–∫–∞—Ü–∏—è –ø–æ–∑, –≥–µ–Ω–µ—Ä–∏—Ä—É–µ—Ç—Å—è —á–µ—Ä–µ–∑ `train_pt.py --convert`)**:
  - –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∞—è –∫–æ–Ω–≤–µ—Ä—Ç–∞—Ü–∏—è –∏–∑ YOLO-–¥–∞—Ç–∞—Å–µ—Ç–∞: –ö—Ä–æ–ø—ã –ø–æ bbox —Å–æ—Ö—Ä–∞–Ω—è—é—Ç—Å—è –≤ `train/dataset/<state>/` (–Ω–∞–ø—Ä–∏–º–µ—Ä, `Feeding/`, `Standing/`).
  - –¢—Ä–µ–±–æ–≤–∞–Ω–∏—è: >100 –∫—Ä–æ–ø–æ–≤ –Ω–∞ –∫–ª–∞—Å—Å (5 –∫–ª–∞—Å—Å–æ–≤ –∏–∑ `pig_states.db`), –±–∞–ª–∞–Ω—Å –∫–ª–∞—Å—Å–æ–≤, —Ä–∞–∑–Ω–æ–æ–±—Ä–∞–∑–∏–µ –ø–æ–∑. –ü–æ—Å–ª–µ –∫–æ–Ω–≤–µ—Ä—Ç–∞—Ü–∏–∏ ‚Äî —Å—Ç–∞–Ω–¥–∞—Ä—Ç–Ω—ã–π ImageFolder —Ñ–æ—Ä–º–∞—Ç.

–î–∞—Ç–∞—Å–µ—Ç –¥–æ–ª–∂–µ–Ω –±—ã—Ç—å —á–∏—Å—Ç—ã–º (–±–µ–∑ –∞—Ä—Ç–µ—Ñ–∞–∫—Ç–æ–≤), –∞–Ω–Ω–æ—Ç–∏—Ä–æ–≤–∞–Ω–Ω—ã–º.

## 6. –í–æ–∑–º–æ–∂–Ω—ã–µ –ø—Ä–æ–±–ª–µ–º—ã

- **–û—à–∏–±–∫–∏ –¥–µ—Ç–µ–∫—Ü–∏–∏**: –ù–µ—Ç –æ–±—ä–µ–∫—Ç–æ–≤ ‚Äî –≤–∏–¥–µ–æ –Ω–µ —Å–æ–¥–µ—Ä–∂–∏—Ç —Å–≤–∏–Ω–µ–π –∏–ª–∏ –º–æ–¥–µ–ª—å –Ω–µ –¥–æ–æ–±—É—á–µ–Ω–∞. –†–µ—à–µ–Ω–∏–µ: –ü–µ—Ä–µ–æ–±—É—á–∏—Ç—å YOLO, –ø—Ä–æ–≤–µ—Ä–∏—Ç—å –≤–∏–¥–µ–æ.
- **–û—à–∏–±–∫–∏ –∫–ª–∞—Å—Å–∏—Ñ–∏–∫–∞—Ü–∏–∏**: –ü–æ–∑—ã –Ω–µ –æ–ø—Ä–µ–¥–µ–ª—è—é—Ç—Å—è ‚Äî –º–æ–¥–µ–ª—å –Ω–µ –æ–±—É—á–µ–Ω–∞ –∏–ª–∏ –∫—Ä–æ–ø—ã –ø—É—Å—Ç—ã–µ. –†–µ—à–µ–Ω–∏–µ: –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –ª–æ–≥–∏ `classify_pig_states`, –ø–µ—Ä–µ–æ–±—É—á–∏—Ç—å `train_pt.py`.
- **–ü—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å**: –ú–µ–¥–ª–µ–Ω–Ω–∞—è –æ–±—Ä–∞–±–æ—Ç–∫–∞ ‚Äî —Å–ª–∞–±—ã–π GPU/CPU. –†–µ—à–µ–Ω–∏–µ: –£–º–µ–Ω—å—à–∏—Ç—å batch_size –≤ –æ–±—É—á–µ–Ω–∏–∏, –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å AMP –≤ YOLO.
- **–û—à–∏–±–∫–∏ –∏–º–ø–æ—Ä—Ç–∞**: `cv2 not defined` –∏–ª–∏ –ø–æ–¥–æ–±–Ω—ã–µ ‚Äî –∑–∞–±—ã–ª–∏ –∏–º–ø–æ—Ä—Ç. –†–µ—à–µ–Ω–∏–µ: –î–æ–±–∞–≤–∏—Ç—å `import cv2` –≤ —Ñ–∞–π–ª.
- **404 –¥–ª—è —Ñ–∞–π–ª–æ–≤**: –§–∞–π–ª –æ—Ç—Å—É—Ç—Å—Ç–≤—É–µ—Ç. –†–µ—à–µ–Ω–∏–µ: –°–æ–∑–¥–∞—Ç—å —Ñ–∞–π–ª –≤ –Ω—É–∂–Ω–æ–π –ø–∞–ø–∫–µ.
- **–ë–∞–∑–∞ –¥–∞–Ω–Ω—ã—Ö**: `pig_states.db` –Ω–µ —Å–æ–∑–¥–∞–µ—Ç—Å—è ‚Äî –ø—Ä–∞–≤–∞ –¥–æ—Å—Ç—É–ø–∞. –†–µ—à–µ–Ω–∏–µ: –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏—é.
- **CUDA –æ—à–∏–±–∫–∏**: –ù–µ—Ç GPU ‚Äî fallback –Ω–∞ CPU, –Ω–æ –º–µ–¥–ª–µ–Ω–Ω–µ–µ. –†–µ—à–µ–Ω–∏–µ: –£—Å—Ç–∞–Ω–æ–≤–∏—Ç—å CUDA Toolkit –∏ –¥—Ä–∞–π–≤–µ—Ä—ã NVIDIA.

–õ–æ–≥–∏ –ø–æ–º–æ–≥–∞—é—Ç –¥–∏–∞–≥–Ω–æ—Å—Ç–∏–∫–µ (–∏—â–∏—Ç–µ `üö®` –¥–ª—è –æ—à–∏–±–æ–∫).

## 7. –ò–Ω—Å—Ç—Ä—É–∫—Ü–∏–∏ –ø–æ –∑–∞–ø—É—Å–∫—É

### 7.1 –ò–Ω—Å—Ç—Ä—É–∫—Ü–∏—è –ø–æ —É—Å—Ç–∞–Ω–æ–≤–∫–µ CUDA –¥–ª—è GPU
1. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ —Å–æ–≤–º–µ—Å—Ç–∏–º–æ—Å—Ç—å: NVIDIA GPU —Å Compute Capability >=3.5 (–ø—Ä–æ–≤–µ—Ä—å—Ç–µ –Ω–∞ developer.nvidia.com/cuda-gpus).
2. –£—Å—Ç–∞–Ω–æ–≤–∏—Ç–µ –¥—Ä–∞–π–≤–µ—Ä—ã NVIDIA: –°–∫–∞—á–∞–π—Ç–µ —Å nvidia.com/drivers (–≤–µ—Ä—Å–∏—è >=535 –¥–ª—è CUDA 12.x).
3. –£—Å—Ç–∞–Ω–æ–≤–∏—Ç–µ CUDA Toolkit: –°–∫–∞—á–∞–π—Ç–µ —Å developer.nvidia.com/cuda-downloads (–≤–µ—Ä—Å–∏—è 12.x –¥–ª—è PyTorch 2.7.1).
   - –í—ã–ø–æ–ª–Ω–∏—Ç–µ —É—Å—Ç–∞–Ω–æ–≤—â–∏–∫, –¥–æ–±–∞–≤—å—Ç–µ –≤ PATH: `export PATH=/usr/local/cuda-12.x/bin:$PATH` (Unix) –∏–ª–∏ –∞–Ω–∞–ª–æ–≥–∏—á–Ω–æ –Ω–∞ Windows.
4. –£—Å—Ç–∞–Ω–æ–≤–∏—Ç–µ cuDNN: –°–∫–∞—á–∞–π—Ç–µ —Å developer.nvidia.com/cudnn (–≤–µ—Ä—Å–∏—è –¥–ª—è CUDA 12.x), —Å–∫–æ–ø–∏—Ä—É–π—Ç–µ —Ñ–∞–π–ª—ã –≤ `/usr/local/cuda/`.
5. –£—Å—Ç–∞–Ω–æ–≤–∏—Ç–µ PyTorch —Å CUDA: `pip install torch torchvision --extra-index-url https://download.pytorch.org/whl/cu128`.
6. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ: `python -c "import torch; print(torch.cuda.is_available())"` ‚Äî –¥–æ–ª–∂–Ω–æ –≤—ã–≤–µ—Å—Ç–∏ True.

### 7.2 –í–∞—Ä–∏–∞–Ω—Ç –¥–ª—è CPU
1. –£—Å—Ç–∞–Ω–æ–≤–∏—Ç–µ PyTorch –±–µ–∑ CUDA: `pip install torch torchvision`.
2. –í `.env` —É–∫–∞–∂–∏—Ç–µ `device=cpu`.
3. –ó–∞–ø—É—Å—Ç–∏—Ç–µ –±–µ–∑ GPU-–∞—Ä–≥—É–º–µ–Ω—Ç–æ–≤. –ü—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å –Ω–∏–∂–µ (–æ–±—Ä–∞–±–æ—Ç–∫–∞ –∫–∞–¥—Ä–æ–≤ ~0.5-1 —Å–µ–∫), –Ω–æ —Å–∏—Å—Ç–µ–º–∞ —Ä–∞–±–æ—Ç–æ—Å–ø–æ—Å–æ–±–Ω–∞.

### –û—Å–Ω–æ–≤–Ω–∞—è –∏–Ω—Å—Ç—Ä—É–∫—Ü–∏—è
1. –ö–ª–æ–Ω–∏—Ä—É–π—Ç–µ —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏–π: `git clone <repo_url>`.
2. –°–æ–∑–¥–∞–π—Ç–µ –≤–∏—Ä—Ç—É–∞–ª—å–Ω–æ–µ –æ–∫—Ä—É–∂–µ–Ω–∏–µ: `python -m venv env; source env/bin/activate`.
3. –£—Å—Ç–∞–Ω–æ–≤–∏—Ç–µ –±–∏–±–ª–∏–æ—Ç–µ–∫–∏: `pip install -r requirements.txt`.
4. –û–±—É—á–∏—Ç–µ –º–æ–¥–µ–ª–∏:
   - –î–µ—Ç–µ–∫—Ü–∏—è: `python train/train_yolo.py --dataset_dir train/object --class_name pig`. –ü–µ—Ä–µ–Ω–µ—Å–∏—Ç–µ –≤—ã—Ö–æ–¥–Ω—É—é –º–æ–¥–µ–ª—å (–Ω–∞–ø—Ä–∏–º–µ—Ä, yolo11m-seg-mod.pt) –∏–∑ `train/models/` –≤ `models/`, –æ–±–Ω–æ–≤–∏—Ç–µ MODEL_PATH –≤ .env.
   - –ö–ª–∞—Å—Å–∏—Ñ–∏–∫–∞—Ü–∏—è: `python train/train_pt.py --convert`.
5. –ó–∞–ø—É—Å—Ç–∏—Ç–µ —Å–µ—Ä–≤–µ—Ä: `python run.py --device cuda --video test_data/pigs.mp4` (–∏–ª–∏ cpu).
6. –û—Ç–∫—Ä–æ–π—Ç–µ –±—Ä–∞—É–∑–µ—Ä: `http://127.0.0.1:9001`.
7. –¢–µ—Å—Ç—ã: `python -m unittest discover tests`.