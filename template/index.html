<!DOCTYPE html>
<html lang="ru">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>–°–∏—Å—Ç–µ–º–∞ –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥–∞ —Å–≤–∏–Ω–µ–π</title>
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
  <link href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.10.0/font/bootstrap-icons.css" rel="stylesheet">
  <link rel="stylesheet" href="/static/css/styles.css">
  <link rel="manifest" href="/static/manifest.json">
</head>
<body>
  <!-- Dark Mode Toggle -->
  <button id="darkModeToggle" class="btn btn-outline-secondary" title="–ü–µ—Ä–µ–∫–ª—é—á–∏—Ç—å —Ç–µ–º—É">
    <i class="bi bi-moon-stars"></i>
  </button>

  <div class="container-fluid px-4">
    <!-- Header -->
    <div class="main-header">
      <div class="container">
        <div class="row align-items-center">
          <div class="col-md-8">
            <h1 class="mb-0 fw-bold">
              üê∑ <i class="bi bi-camera-video me-2"></i>
              –°–∏—Å—Ç–µ–º–∞ –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥–∞ —Å–≤–∏–Ω–µ–π
            </h1>
            <p class="mb-0 mt-2 opacity-75">
              ü§ñ –ò–Ω—Ç–µ–ª–ª–µ–∫—Ç—É–∞–ª—å–Ω—ã–π –∞–Ω–∞–ª–∏–∑ –ø–æ–≤–µ–¥–µ–Ω–∏—è –∂–∏–≤–æ—Ç–Ω—ã—Ö —Å –ò–ò
            </p>
          </div>
          <div class="col-md-4 text-end">
            <div class="d-flex align-items-center justify-content-end">
              <div class="status-indicator status-online me-2"></div>
              <small class="text-white-50">üü¢ –°–∏—Å—Ç–µ–º–∞ –∞–∫—Ç–∏–≤–Ω–∞</small>
            </div>
          </div>
        </div>
      </div>
    </div>

    <!-- User Info & Quick Actions -->
    <div class="user-info">
      <div class="row align-items-center">
        <div class="col-md-6">
          <div class="d-flex align-items-center">
            <div class="user-avatar me-3">
              üë§
            </div>
            <div>
              <small class="text-muted d-block">üëã –î–æ–±—Ä–æ –ø–æ–∂–∞–ª–æ–≤–∞—Ç—å</small>
              <strong>{{ current_user.username }}</strong>
              {% if current_user.is_admin %}
                <span class="badge bg-warning text-dark ms-2">‚≠ê –ê–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä</span>
              {% endif %}
            </div>
          </div>
        </div>
        <div class="col-md-6 text-end">
          <div class="quick-actions">
            {% if current_user.is_admin %}
              <a href="{{ url_for('auth.register') }}" class="btn btn-outline-custom btn-sm">
                <i class="bi bi-person-plus me-1"></i>üë• –î–æ–±–∞–≤–∏—Ç—å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
              </a>
            {% endif %}
            <a href="{{ url_for('auth.logout') }}" class="btn btn-outline-danger btn-sm">
              <i class="bi bi-box-arrow-right me-1"></i>üö™ –í—ã–π—Ç–∏
            </a>
          </div>
        </div>
      </div>
    </div>

    <!-- Main Navigation -->
    <div class="nav-controls">
      <div class="row align-items-center">
        <div class="col-md-6">
          <h5 class="mb-0">
            <i class="bi bi-gear me-2"></i>‚ö° –ü–∞–Ω–µ–ª—å —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è
          </h5>
        </div>
        <div class="col-md-6 text-end">
          <div class="btn-group" role="group">
            <button class="btn btn-custom btn-sm" data-bs-toggle="modal" data-bs-target="#stateModal">
              <i class="bi bi-tags me-1"></i>üè∑Ô∏è –°–æ—Å—Ç–æ—è–Ω–∏—è
            </button>
            <button class="btn btn-custom btn-sm" data-bs-toggle="modal" data-bs-target="#trainModal">
              <i class="bi bi-robot me-1"></i>ü§ñ –û–±—É—á–µ–Ω–∏–µ
            </button>
            <button class="btn btn-outline-custom btn-sm" data-bs-toggle="modal" data-bs-target="#sourceManagementModal">
              <i class="bi bi-collection-play me-1"></i>üìÅ –ò—Å—Ç–æ—á–Ω–∏–∫–∏
            </button>
            <button class="btn btn-outline-custom btn-sm" data-bs-toggle="modal" data-bs-target="#translationsModal">
              <i class="bi bi-translate me-1"></i>üåê –ü–µ—Ä–µ–≤–æ–¥—ã
            </button>
          </div>
        </div>
      </div>
    </div>

    <!-- KPI Dashboard -->
    <div class="row g-3 mb-4">
      <div class="col-md-6 col-lg-3">
        <div class="kpi-card kpi-gradient-1">
          <div class="kpi-icon">üê∑</div>
          <div class="kpi-value" id="totalPigs">
            <div class="loading-spinner"></div>
          </div>
          <div class="kpi-label">üìä –û–±—â–µ–µ –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ —Å–≤–∏–Ω–µ–π</div>
        </div>
      </div>
      <div class="col-md-6 col-lg-3">
        <div class="kpi-card kpi-gradient-2">
          <div class="kpi-icon">‚ö°</div>
          <div class="kpi-value" id="activePigs">
            <div class="loading-spinner"></div>
          </div>
          <div class="kpi-label">üéØ –ü—Ä–æ—Ü–µ–Ω—Ç –∞–∫—Ç–∏–≤–Ω—ã—Ö —Å–≤–∏–Ω–µ–π</div>
        </div>
      </div>
      <div class="col-md-6 col-lg-3">
        <div class="kpi-card kpi-gradient-3">
          <div class="kpi-icon">‚è±Ô∏è</div>
          <div class="kpi-value" id="avgStateTime">
            <div class="loading-spinner"></div>
          </div>
          <div class="kpi-label">‚åõ –°—Ä–µ–¥–Ω–µ–µ –≤—Ä–µ–º—è –≤ —Å–æ—Å—Ç–æ—è–Ω–∏–∏</div>
        </div>
      </div>
      <div class="col-md-6 col-lg-3">
        <div class="kpi-card kpi-gradient-4">
          <div class="kpi-icon">üìù</div>
          <div class="kpi-value" id="totalStates">
            <div class="loading-spinner"></div>
          </div>
          <div class="kpi-label">üóÇÔ∏è –í—Å–µ–≥–æ —Å–æ—Å—Ç–æ—è–Ω–∏–π –≤ –±–∞–∑–µ</div>
        </div>
      </div>
    </div>

    <!-- Video Source Selection -->
    <div class="row mb-4">
      <div class="col-12">
        <div class="dashboard-card p-3">
          <div class="row align-items-center">
            <div class="col-md-6">
              <h5 class="mb-0">
                <i class="bi bi-play-circle me-2"></i>üìπ –í—ã–±–æ—Ä –∏—Å—Ç–æ—á–Ω–∏–∫–∞ –≤–∏–¥–µ–æ
              </h5>
            </div>
            <div class="col-md-6">
              <form id="videoSourceForm" class="d-flex gap-2">
                <select name="source" id="source" class="form-select">
                  <option value="webcam">üì∑ –í–µ–±-–∫–∞–º–µ—Ä–∞</option>
                  <option value="remote_camera">üì° –£–¥–∞–ª–µ–Ω–Ω–∞—è –∫–∞–º–µ—Ä–∞</option>
                  {% for source, type in sources %}
                  <option value="{{ source }}" {% if source == current_source %}selected{% endif %}>
                    {% if type == '–í–∏–¥–µ–æ' %}üé¨{% else %}üñºÔ∏è{% endif %} {{ source }}
                  </option>
                  {% endfor %}
                </select>
                <button type="submit" class="btn btn-custom">
                  <i class="bi bi-arrow-repeat me-1"></i>üîÑ –°–º–µ–Ω–∏—Ç—å
                </button>
                <button type="button" class="btn btn-outline-custom" data-bs-toggle="modal" data-bs-target="#remoteCameraModal">
                  <i class="bi bi-gear me-1"></i>‚öôÔ∏è –ù–∞—Å—Ç—Ä–æ–π–∫–∏
                </button>
              </form>
            </div>
          </div>
        </div>
      </div>
    </div>

    <!-- Alert Area -->
    <div id="alert-area" class="mb-4"></div>

    <!-- Main Content Grid -->
    <div class="row g-4">
      <!-- Video Feed Section -->
      <div class="col-12 col-lg-6 col-xl-5">
        <div class="dashboard-card p-3">
          <div class="d-flex justify-content-between align-items-center mb-3">
            <h5 class="mb-0">
              <i class="bi bi-camera-video me-2"></i>üì∫ –í–∏–¥–µ–æ –ø–æ—Ç–æ–∫
            </h5>
            <div class="d-flex align-items-center">
              <div class="status-indicator status-online me-2"></div>
              <small class="text-muted">üü¢ –û–Ω–ª–∞–π–Ω</small>
            </div>
          </div>
          <div class="video-container position-relative">
            <img id="videoFeed" class="img-fluid w-100" src="" alt="–í–∏–¥–µ–æ –ø–æ—Ç–æ–∫" style="max-height: 400px; object-fit: contain;">
            <div id="videoError" class="position-absolute top-50 start-50 translate-middle text-center text-danger d-none">
              <i class="bi bi-exclamation-triangle fs-1"></i>
              <p class="mt-2">‚ùå –û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ –≤–∏–¥–µ–æ–ø–æ—Ç–æ–∫–∞</p>
            </div>
            <div id="videoLoading" class="position-absolute top-50 start-50 translate-middle d-none">
              <div class="loading-spinner"></div>
            </div>
          </div>
        </div>
      </div>

      <!-- Analytics Sidebar -->
      <div class="col-12 col-lg-6 col-xl-7">
        <div class="dashboard-card p-3">
          <h5 class="mb-3">
            <i class="bi bi-graph-up me-2"></i>üìä –ê–Ω–∞–ª–∏—Ç–∏–∫–∞ –∏ –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥
          </h5>

          <!-- Pig Selection -->
          <div class="mb-3">
            <label for="chartTrackFilter" class="form-label small fw-semibold">
              <i class="bi bi-filter me-1"></i>üê∑ –í—ã–±–µ—Ä–∏—Ç–µ ID —Å–≤–∏–Ω—å–∏:
            </label>
            <select id="chartTrackFilter" class="form-select form-select-sm"></select>
          </div>

          <!-- Charts Row -->
          <div class="row g-3">
            <div class="col-md-6">
              <div class="chart-card">
                <h6 class="text-center mb-2">üìà –°–æ—Å—Ç–æ—è–Ω–∏—è</h6>
                <div id="stateChart" style="height: 200px;"></div>
              </div>
            </div>
            <div class="col-md-6">
              <div class="chart-card">
                <h6 class="text-center mb-2">‚è∞ –î–ª–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å</h6>
                <div id="durationChart" style="height: 200px;"></div>
              </div>
            </div>
          </div>
        </div>
      </div>

      <!-- Activity Log -->
      <div class="col-12">
        <div class="dashboard-card p-3">
          <div class="d-flex justify-content-between align-items-center mb-3">
            <h5 class="mb-0">
              <i class="bi bi-activity me-2"></i>üìã –ñ—É—Ä–Ω–∞–ª –∞–∫—Ç–∏–≤–Ω–æ—Å—Ç–∏
            </h5>
            <div class="d-flex gap-2">
              <button id="clearLogBtn" class="btn btn-outline-secondary btn-sm">
                <i class="bi bi-trash me-1"></i>üóëÔ∏è –û—á–∏—Å—Ç–∏—Ç—å
              </button>
              <button id="exportLogBtn" class="btn btn-outline-primary btn-sm">
                <i class="bi bi-download me-1"></i>üíæ –≠–∫—Å–ø–æ—Ä—Ç
              </button>
            </div>
          </div>

          <!-- Filters -->
          <div class="row g-2 mb-3">
            <div class="col-md-4">
              <input type="text" id="filterTime" class="form-control form-control-sm"
                     placeholder="–§–∏–ª—å—Ç—Ä –ø–æ –≤—Ä–µ–º–µ–Ω–∏ (YYYY-MM-DD HH:MM:SS)">
            </div>
            <div class="col-md-4">
              <input type="text" id="filterTrack" class="form-control form-control-sm"
                     placeholder="–§–∏–ª—å—Ç—Ä –ø–æ ID —Å–≤–∏–Ω—å–∏">
            </div>
            <div class="col-md-4">
              <select id="sortTrack" class="form-select form-select-sm">
                <option value="">–í—ã–±–µ—Ä–∏—Ç–µ ID —Å–≤–∏–Ω—å–∏</option>
              </select>
            </div>
          </div>

          <!-- Log Table -->
          <div class="table-responsive">
            <table class="table table-hover" id="logTable">
              <thead class="table-light">
                <tr>
                  <th scope="col" style="width: 180px;">
                    <i class="bi bi-clock me-1"></i>–í—Ä–µ–º—è
                  </th>
                  <th scope="col" style="width: 100px;">
                    <i class="bi bi-hash me-1"></i>ID
                  </th>
                  <th scope="col">
                    <i class="bi bi-chat-text me-1"></i>–°–æ–±—ã—Ç–∏–µ
                  </th>
                </tr>
              </thead>
              <tbody></tbody>
            </table>
          </div>

          <!-- Empty State -->
          <div id="emptyLogState" class="text-center py-4 text-muted d-none">
            <i class="bi bi-info-circle fs-1"></i>
            <p class="mt-2">–ñ—É—Ä–Ω–∞–ª –∞–∫—Ç–∏–≤–Ω–æ—Å—Ç–∏ –ø—É—Å—Ç</p>
          </div>
        </div>
      </div>
    </div>
  </div>

  <!-- Modal: State Management -->
  <div class="modal fade" id="stateModal" tabindex="-1" aria-labelledby="stateModalLabel" aria-hidden="true">
    <div class="modal-dialog modal-xl">
      <div class="modal-content">
        <div class="modal-header bg-primary text-white">
          <h5 class="modal-title" id="stateModalLabel">
            <i class="bi bi-tags me-2"></i>–£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ —Å–æ—Å—Ç–æ—è–Ω–∏—è–º–∏
          </h5>
          <button type="button" class="btn-close btn-close-white" data-bs-dismiss="modal" aria-label="Close"></button>
        </div>
        <div class="modal-body" id="stateModalBody">
          <div class="d-flex justify-content-between align-items-center mb-4">
            <div>
              <h6 class="mb-0">–°–ø–∏—Å–æ–∫ —Å–æ—Å—Ç–æ—è–Ω–∏–π —Å–∏—Å—Ç–µ–º—ã</h6>
              <small class="text-muted">–£–ø—Ä–∞–≤–ª—è–π—Ç–µ —Å–æ—Å—Ç–æ—è–Ω–∏—è–º–∏ –ø–æ–≤–µ–¥–µ–Ω–∏—è —Å–≤–∏–Ω–µ–π</small>
            </div>
            <button class="btn btn-custom" id="addStateBtn">
              <i class="bi bi-plus-circle me-1"></i>–î–æ–±–∞–≤–∏—Ç—å —Å–æ—Å—Ç–æ—è–Ω–∏–µ
            </button>
          </div>

          <div class="table-responsive">
            <table class="table table-hover" id="stateTable">
              <thead class="table-light">
                <tr>
                  <th scope="col" style="width: 20%;">
                    <i class="bi bi-hash me-1"></i>–ö–æ–¥
                  </th>
                  <th scope="col">
                    <i class="bi bi-card-text me-1"></i>–û–ø–∏—Å–∞–Ω–∏–µ
                  </th>
                  <th scope="col" style="width: 200px;">
                    <i class="bi bi-gear me-1"></i>–î–µ–π—Å—Ç–≤–∏—è
                  </th>
                </tr>
              </thead>
              <tbody></tbody>
            </table>
          </div>

          <!-- Empty State -->
          <div id="emptyStatesState" class="text-center py-5 text-muted d-none">
            <i class="bi bi-tags fs-1"></i>
            <h6 class="mt-3">–°–æ—Å—Ç–æ—è–Ω–∏—è –Ω–µ –Ω–∞–π–¥–µ–Ω—ã</h6>
            <p>–î–æ–±–∞–≤—å—Ç–µ –ø–µ—Ä–≤–æ–µ —Å–æ—Å—Ç–æ—è–Ω–∏–µ –¥–ª—è –Ω–∞—á–∞–ª–∞ —Ä–∞–±–æ—Ç—ã</p>
          </div>
        </div>
        <div class="modal-footer">
          <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">
            <i class="bi bi-x me-1"></i>–ó–∞–∫—Ä—ã—Ç—å
          </button>
        </div>
      </div>
    </div>
  </div>

  <!-- Modal: Dataset Management -->
  <div class="modal fade" id="datasetModal" tabindex="-1" aria-labelledby="datasetModalLabel" aria-hidden="true">
    <div class="modal-dialog modal-xl">
      <div class="modal-content">
        <div class="modal-header bg-success text-white">
          <h5 class="modal-title" id="datasetModalLabel">
            <i class="bi bi-folder me-2"></i>–£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –¥–∞—Ç–∞—Å–µ—Ç–æ–º
          </h5>
          <button type="button" class="btn-close btn-close-white" data-bs-dismiss="modal" aria-label="Close"></button>
        </div>
        <div class="modal-body">
          <!-- Upload Section -->
          <div class="card mb-4">
            <div class="card-header">
              <h6 class="mb-0">
                <i class="bi bi-upload me-2"></i>–ó–∞–≥—Ä—É–∑–∫–∞ —Ñ–∞–π–ª–æ–≤
              </h6>
            </div>
            <div class="card-body">
              <form id="uploadVideoForm" enctype="multipart/form-data">
                <div class="row align-items-end">
                  <div class="col-md-8">
                    <label for="videoFile" class="form-label fw-semibold">
                      –í—ã–±–µ—Ä–∏—Ç–µ —Ñ–∞–π–ª –¥–ª—è –∑–∞–≥—Ä—É–∑–∫–∏
                    </label>
                    <input type="file" class="form-control" id="videoFile" name="video"
                           accept=".mp4,.jpg,.jpeg,.png,.bmp" multiple>
                    <div class="form-text">
                      –ü–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ–º—ã–µ —Ñ–æ—Ä–º–∞—Ç—ã: MP4, JPG, JPEG, PNG, BMP
                    </div>
                  </div>
                  <div class="col-md-4">
                    <button type="submit" class="btn btn-custom w-100">
                      <i class="bi bi-cloud-upload me-1"></i>–ó–∞–≥—Ä—É–∑–∏—Ç—å
                    </button>
                  </div>
                </div>
                <div class="progress mt-3" id="uploadProgress" style="display: none;">
                  <div class="progress-bar" role="progressbar" style="width: 0%;"
                       aria-valuenow="0" aria-valuemin="0" aria-valuemax="100">
                    –ó–∞–≥—Ä—É–∑–∫–∞...
                  </div>
                </div>
              </form>
            </div>
          </div>

          <!-- Files List -->
          <div class="card">
            <div class="card-header d-flex justify-content-between align-items-center">
              <h6 class="mb-0">
                <i class="bi bi-files me-2"></i>–§–∞–π–ª—ã –¥–∞—Ç–∞—Å–µ—Ç–∞
              </h6>
              <small class="text-muted" id="fileCount">0 —Ñ–∞–π–ª–æ–≤</small>
            </div>
            <div class="card-body">
              <div class="table-responsive">
                <table class="table table-hover" id="videoTable">
                  <thead class="table-light">
                    <tr>
                      <th scope="col" style="width: 50px;">
                        <i class="bi bi-file-earmark me-1"></i>
                      </th>
                      <th scope="col">–ò–º—è —Ñ–∞–π–ª–∞</th>
                      <th scope="col" style="width: 100px;">–¢–∏–ø</th>
                      <th scope="col" style="width: 150px;">–î–µ–π—Å—Ç–≤–∏—è</th>
                    </tr>
                  </thead>
                  <tbody></tbody>
                </table>
              </div>

              <!-- Pagination -->
              <nav aria-label="–ü–∞–≥–∏–Ω–∞—Ü–∏—è —Ñ–∞–π–ª–æ–≤" class="mt-3">
                <div class="pagination-container">
                  <ul class="pagination justify-content-center" id="pagination"></ul>
                </div>
              </nav>

              <!-- Empty State -->
              <div id="emptyDatasetState" class="text-center py-5 text-muted d-none">
                <i class="bi bi-folder-x fs-1"></i>
                <h6 class="mt-3">–§–∞–π–ª—ã –Ω–µ –Ω–∞–π–¥–µ–Ω—ã</h6>
                <p>–ó–∞–≥—Ä—É–∑–∏—Ç–µ —Ñ–∞–π–ª—ã –¥–ª—è —Å–æ–∑–¥–∞–Ω–∏—è –¥–∞—Ç–∞—Å–µ—Ç–∞</p>
              </div>
            </div>
          </div>
        </div>
        <div class="modal-footer">
          <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">
            <i class="bi bi-x me-1"></i>–ó–∞–∫—Ä—ã—Ç—å
          </button>
        </div>
      </div>
    </div>
  </div>

  <!-- –ú–æ–¥–∞–ª—å–Ω–æ–µ –æ–∫–Ω–æ –¥–ª—è –ø—Ä–µ–¥–ø—Ä–æ—Å–º–æ—Ç—Ä–∞ -->
  <div class="modal fade" id="previewModal" tabindex="-1" aria-labelledby="previewModalLabel" aria-hidden="true">
    <div class="modal-dialog modal-lg">
      <div class="modal-content">
        <div class="modal-header">
          <h5 class="modal-title" id="previewModalLabel">–ü—Ä–µ–¥–ø—Ä–æ—Å–º–æ—Ç—Ä</h5>
          <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
        </div>
        <div class="modal-body">
          <video controls id="previewVideo" style="display: none;"></video>
          <img id="previewImage" style="display: none;" alt="–ü—Ä–µ–¥–ø—Ä–æ—Å–º–æ—Ç—Ä">
        </div>
        <div class="modal-footer">
          <button type="button" class="btn btn-secondary" id="backToDatasetModal">–ù–∞–∑–∞–¥</button>
        </div>
      </div>
    </div>
  </div>

  <!-- –ú–æ–¥–∞–ª—å–Ω–æ–µ –æ–∫–Ω–æ –¥–ª—è —É–≤–µ–ª–∏—á–µ–Ω–Ω–æ–≥–æ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è -->
  <div class="modal fade" id="imagePreviewModal" tabindex="-1" aria-labelledby="imagePreviewModalLabel" aria-hidden="true">
    <div class="modal-dialog modal-lg">
      <div class="modal-content">
        <div class="modal-header">
          <h5 class="modal-title" id="imagePreviewModalLabel">–£–≤–µ–ª–∏—á–µ–Ω–Ω–æ–µ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–µ</h5>
          <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
        </div>
        <div class="modal-body">
          <img id="enlargedImage" alt="–£–≤–µ–ª–∏—á–µ–Ω–Ω–æ–µ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–µ">
        </div>
        <div class="modal-footer">
          <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">–ó–∞–∫—Ä—ã—Ç—å</button>
        </div>
      </div>
    </div>
  </div>

  <!-- Modal: Model Training -->
  <div class="modal fade" id="trainModal" tabindex="-1" aria-labelledby="trainModalLabel" aria-hidden="true">
    <div class="modal-dialog modal-xl">
      <div class="modal-content">
        <div class="modal-header bg-info text-white">
          <h5 class="modal-title" id="trainModalLabel">
            <i class="bi bi-robot me-2"></i>–û–±—É—á–µ–Ω–∏–µ –º–æ–¥–µ–ª–∏
          </h5>
          <button type="button" class="btn-close btn-close-white" data-bs-dismiss="modal" aria-label="Close"></button>
        </div>
        <div class="modal-body">
          <!-- Training Info -->
          <div class="alert alert-info mb-4">
            <h6 class="alert-heading">
              <i class="bi bi-info-circle me-2"></i>–ò–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –æ–± –æ–±—É—á–µ–Ω–∏–∏
            </h6>
            <p class="mb-0">
              –ü—Ä–æ—Ü–µ—Å—Å –æ–±—É—á–µ–Ω–∏—è –º–æ–∂–µ—Ç –∑–∞–Ω—è—Ç—å –ø—Ä–æ–¥–æ–ª–∂–∏—Ç–µ–ª—å–Ω–æ–µ –≤—Ä–µ–º—è –≤ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ –æ—Ç –æ–±—ä–µ–º–∞ –¥–∞—Ç–∞—Å–µ—Ç–∞.
              –ù–µ –∑–∞–∫—Ä—ã–≤–∞–π—Ç–µ —ç—Ç–æ –æ–∫–Ω–æ –≤–æ –≤—Ä–µ–º—è –æ–±—É—á–µ–Ω–∏—è.
            </p>
          </div>

          <!-- Training Controls -->
          <div class="d-flex justify-content-between align-items-center mb-3">
            <div>
              <h6 class="mb-0">–õ–æ–≥ –æ–±—É—á–µ–Ω–∏—è –º–æ–¥–µ–ª–∏</h6>
              <small class="text-muted">–û—Ç—Å–ª–µ–∂–∏–≤–∞–π—Ç–µ –ø—Ä–æ–≥—Ä–µ—Å—Å –æ–±—É—á–µ–Ω–∏—è –≤ —Ä–µ–∞–ª—å–Ω–æ–º –≤—Ä–µ–º–µ–Ω–∏</small>
            </div>
            <div class="d-flex gap-2">
              <button id="clearTrainingLogBtn" class="btn btn-outline-secondary btn-sm">
                <i class="bi bi-trash me-1"></i>–û—á–∏—Å—Ç–∏—Ç—å –ª–æ–≥
              </button>
              <button id="downloadTrainingLogBtn" class="btn btn-outline-primary btn-sm">
                <i class="bi bi-download me-1"></i>–°–∫–∞—á–∞—Ç—å –ª–æ–≥
              </button>
            </div>
          </div>

          <!-- Training Log -->
          <div id="trainingLog" class="bg-dark text-light p-3 rounded"
               style="height: 400px; overflow-y: auto; font-family: 'Courier New', monospace; font-size: 0.9rem;">
            <div class="text-muted">
              <i class="bi bi-terminal me-1"></i>
              –û–∂–∏–¥–∞–Ω–∏–µ –Ω–∞—á–∞–ª–∞ –æ–±—É—á–µ–Ω–∏—è...
            </div>
          </div>

          <!-- Training Progress -->
          <div id="trainingProgress" class="mt-3 d-none">
            <div class="d-flex justify-content-between align-items-center mb-2">
              <small class="fw-semibold">–ü—Ä–æ–≥—Ä–µ—Å—Å –æ–±—É—á–µ–Ω–∏—è</small>
              <small id="progressText">0%</small>
            </div>
            <div class="progress">
              <div class="progress-bar progress-bar-striped progress-bar-animated"
                   role="progressbar" style="width: 0%" id="progressBar"></div>
            </div>
          </div>
        </div>
        <div class="modal-footer">
          <button type="button" class="btn btn-custom" id="startTrainingBtn">
            <i class="bi bi-play-circle me-1"></i>–ù–∞—á–∞—Ç—å –æ–±—É—á–µ–Ω–∏–µ
          </button>
          <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">
            <i class="bi bi-x me-1"></i>–ó–∞–∫—Ä—ã—Ç—å
          </button>
        </div>
      </div>
    </div>
  </div>

  <!-- Modal: Remote Camera Settings -->
  <div class="modal fade" id="remoteCameraModal" tabindex="-1" aria-labelledby="remoteCameraModalLabel" aria-hidden="true">
    <div class="modal-dialog modal-lg">
      <div class="modal-content">
        <div class="modal-header bg-info text-white">
          <h5 class="modal-title" id="remoteCameraModalLabel">
            <i class="bi bi-router me-2"></i>üì° –ù–∞—Å—Ç—Ä–æ–π–∫–∏ —É–¥–∞–ª–µ–Ω–Ω–æ–π –∫–∞–º–µ—Ä—ã
          </h5>
          <button type="button" class="btn-close btn-close-white" data-bs-dismiss="modal" aria-label="Close"></button>
        </div>
        <div class="modal-body">
          <form id="remoteCameraForm">
            <div class="alert alert-info">
              <h6 class="alert-heading">
                <i class="bi bi-info-circle me-2"></i>‚ÑπÔ∏è –ò–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è
              </h6>
              <p class="mb-0">
                –ù–∞—Å—Ç—Ä–æ–π—Ç–µ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏–µ –∫ —É–¥–∞–ª–µ–Ω–Ω–æ–π IP-–∫–∞–º–µ—Ä–µ –∏–ª–∏ RTSP –ø–æ—Ç–æ–∫—É –¥–ª—è –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥–∞ —Å–≤–∏–Ω–µ–π.
              </p>
            </div>

            <div class="row g-3">
              <div class="col-md-6">
                <label for="cameraType" class="form-label fw-semibold">
                  <i class="bi bi-camera me-1"></i>üé• –¢–∏–ø –∫–∞–º–µ—Ä—ã
                </label>
                <select class="form-select" id="cameraType">
                  <option value="ip">üìπ IP-–∫–∞–º–µ—Ä–∞ (HTTP)</option>
                  <option value="rtsp">üì° RTSP –ø–æ—Ç–æ–∫</option>
                  <option value="rtmp">üî¥ RTMP –ø–æ—Ç–æ–∫</option>
                  <option value="usb">üîå USB –∫–∞–º–µ—Ä–∞</option>
                </select>
              </div>
              <div class="col-md-6">
                <label for="cameraResolution" class="form-label fw-semibold">
                  <i class="bi bi-aspect-ratio me-1"></i>üìê –†–∞–∑—Ä–µ—à–µ–Ω–∏–µ
                </label>
                <select class="form-select" id="cameraResolution">
                  <option value="640x480">640x480 (VGA)</option>
                  <option value="1280x720" selected>1280x720 (HD)</option>
                  <option value="1920x1080">1920x1080 (Full HD)</option>
                  <option value="auto">üîÑ –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏</option>
                </select>
              </div>
            </div>

            <div class="mb-3">
              <label for="cameraUrl" class="form-label fw-semibold">
                <i class="bi bi-link me-1"></i>üîó URL –∞–¥—Ä–µ—Å –ø–æ—Ç–æ–∫–∞
              </label>
              <input type="url" class="form-control" id="cameraUrl" 
                     placeholder="rtsp://192.168.1.100:554/stream –∏–ª–∏ http://192.168.1.100/mjpg/video.mjpg">
              <div class="form-text">
                –ü—Ä–∏–º–µ—Ä—ã: rtsp://user:pass@192.168.1.100:554/stream, http://192.168.1.100/mjpg/video.mjpg
              </div>
            </div>

            <div class="row g-3">
              <div class="col-md-6">
                <label for="cameraUsername" class="form-label fw-semibold">
                  <i class="bi bi-person me-1"></i>üë§ –ò–º—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
                </label>
                <input type="text" class="form-control" id="cameraUsername" placeholder="admin">
              </div>
              <div class="col-md-6">
                <label for="cameraPassword" class="form-label fw-semibold">
                  <i class="bi bi-key me-1"></i>üîë –ü–∞—Ä–æ–ª—å
                </label>
                <input type="password" class="form-control" id="cameraPassword" placeholder="‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢">
              </div>
            </div>

            <div class="row g-3 mt-2">
              <div class="col-md-6">
                <label for="cameraFps" class="form-label fw-semibold">
                  <i class="bi bi-speedometer me-1"></i>‚ö° FPS (–∫–∞–¥—Ä–æ–≤ –≤ —Å–µ–∫—É–Ω–¥—É)
                </label>
                <select class="form-select" id="cameraFps">
                  <option value="10">10 FPS</option>
                  <option value="15">15 FPS</option>
                  <option value="25" selected>25 FPS</option>
                  <option value="30">30 FPS</option>
                </select>
              </div>
              <div class="col-md-6">
                <label for="cameraTimeout" class="form-label fw-semibold">
                  <i class="bi bi-clock me-1"></i>‚è±Ô∏è –¢–∞–π–º–∞—É—Ç (—Å–µ–∫)
                </label>
                <input type="number" class="form-control" id="cameraTimeout" value="30" min="5" max="120">
              </div>
            </div>
          </form>
        </div>
        <div class="modal-footer">
          <button type="button" class="btn btn-outline-secondary" data-bs-dismiss="modal">
            <i class="bi bi-x me-1"></i>‚ùå –û—Ç–º–µ–Ω–∞
          </button>
          <button type="button" class="btn btn-outline-primary" id="testCameraBtn">
            <i class="bi bi-play-circle me-1"></i>üß™ –¢–µ—Å—Ç –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è
          </button>
          <button type="button" class="btn btn-custom" id="saveCameraBtn">
            <i class="bi bi-check-lg me-1"></i>‚úÖ –°–æ—Ö—Ä–∞–Ω–∏—Ç—å
          </button>
        </div>
      </div>
    </div>
  </div>

  <!-- Modal: Translations Management -->
  <div class="modal fade" id="translationsModal" tabindex="-1" aria-labelledby="translationsModalLabel" aria-hidden="true">
    <div class="modal-dialog modal-lg">
      <div class="modal-content">
        <div class="modal-header bg-info text-white">
          <h5 class="modal-title" id="translationsModalLabel">
            <i class="bi bi-translate me-2"></i>üåê –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –ø–µ—Ä–µ–≤–æ–¥–∞–º–∏
          </h5>
          <button type="button" class="btn-close btn-close-white" data-bs-dismiss="modal" aria-label="Close"></button>
        </div>
        <div class="modal-body">
          <div class="alert alert-info">
            <h6 class="alert-heading">
              <i class="bi bi-info-circle me-2"></i>‚ÑπÔ∏è –ò–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è
            </h6>
            <p class="mb-0">
              –ó–¥–µ—Å—å –≤—ã –º–æ–∂–µ—Ç–µ —Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞—Ç—å –ø–µ—Ä–µ–≤–æ–¥—ã —Å–æ—Å—Ç–æ—è–Ω–∏–π –Ω–∞ —Ä–∞–∑–Ω—ã–µ —è–∑—ã–∫–∏. 
              –ü–µ—Ä–µ–≤–æ–¥—ã —Å–æ—Ö—Ä–∞–Ω—è—é—Ç—Å—è –≤ –±–∞–∑–µ –¥–∞–Ω–Ω—ã—Ö –∏ –ø—Ä–∏–º–µ–Ω—è—é—Ç—Å—è —Å—Ä–∞–∑—É.
            </p>
          </div>

          <div class="table-responsive">
            <table class="table table-hover" id="translationsTable">
              <thead class="table-light">
                <tr>
                  <th scope="col" style="width: 25%;">
                    <i class="bi bi-tag me-1"></i>–°–æ—Å—Ç–æ—è–Ω–∏–µ
                  </th>
                  <th scope="col" style="width: 35%;">
                    <i class="bi bi-flag me-1"></i>üá∑üá∫ –†—É—Å—Å–∫–∏–π
                  </th>
                  <th scope="col" style="width: 35%;">
                    <i class="bi bi-flag me-1"></i>üá∫üá∏ English
                  </th>
                  <th scope="col" style="width: 5%;">
                    <i class="bi bi-gear me-1"></i>
                  </th>
                </tr>
              </thead>
              <tbody></tbody>
            </table>
          </div>

          <div id="emptyTranslationsState" class="text-center py-5 text-muted d-none">
            <i class="bi bi-translate fs-1"></i>
            <h6 class="mt-3">üåê –ü–µ—Ä–µ–≤–æ–¥—ã –Ω–µ –Ω–∞–π–¥–µ–Ω—ã</h6>
            <p>–ó–∞–≥—Ä—É–∑–∏—Ç–µ –ø–µ—Ä–µ–≤–æ–¥—ã –∏–ª–∏ –¥–æ–±–∞–≤—å—Ç–µ –Ω–æ–≤—ã–µ —Å–æ—Å—Ç–æ—è–Ω–∏—è</p>
          </div>
        </div>
        <div class="modal-footer">
          <button type="button" class="btn btn-outline-secondary" data-bs-dismiss="modal">
            <i class="bi bi-x me-1"></i>‚ùå –ó–∞–∫—Ä—ã—Ç—å
          </button>
          <button type="button" class="btn btn-outline-primary" id="refreshTranslationsBtn">
            <i class="bi bi-arrow-clockwise me-1"></i>üîÑ –û–±–Ω–æ–≤–∏—Ç—å
          </button>
          <button type="button" class="btn btn-custom" id="saveAllTranslationsBtn">
            <i class="bi bi-check-lg me-1"></i>üíæ –°–æ—Ö—Ä–∞–Ω–∏—Ç—å –≤—Å–µ
          </button>
        </div>
      </div>
    </div>
  </div>

  <!-- Modal: Source Management -->
  <div class="modal fade" id="sourceManagementModal" tabindex="-1" aria-labelledby="sourceManagementModalLabel" aria-hidden="true">
    <div class="modal-dialog modal-xl">
      <div class="modal-content">
        <div class="modal-header bg-success text-white">
          <h5 class="modal-title" id="sourceManagementModalLabel">
            <i class="bi bi-collection-play me-2"></i>üìÅ –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –∏—Å—Ç–æ—á–Ω–∏–∫–∞–º–∏
          </h5>
          <button type="button" class="btn-close btn-close-white" data-bs-dismiss="modal" aria-label="Close"></button>
        </div>
        <div class="modal-body">
          <!-- Upload Section -->
          <div class="card mb-4">
            <div class="card-header">
              <h6 class="mb-0">
                <i class="bi bi-cloud-upload me-2"></i>‚òÅÔ∏è –ó–∞–≥—Ä—É–∑–∫–∞ –º–µ–¥–∏–∞—Ñ–∞–π–ª–æ–≤
              </h6>
            </div>
            <div class="card-body">
              <form id="sourceUploadForm" enctype="multipart/form-data">
                <div class="row align-items-end">
                  <div class="col-md-8">
                    <label for="sourceFiles" class="form-label fw-semibold">
                      üìé –í—ã–±–µ—Ä–∏—Ç–µ —Ñ–∞–π–ª—ã –¥–ª—è –∑–∞–≥—Ä—É–∑–∫–∏
                    </label>
                    <input type="file" class="form-control" id="sourceFiles" name="files"
                           accept=".mp4,.avi,.mov,.mkv,.jpg,.jpeg,.png,.bmp,.gif" multiple>
                    <div class="form-text">
                      –ü–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ–º—ã–µ —Ñ–æ—Ä–º–∞—Ç—ã: MP4, AVI, MOV, MKV, JPG, JPEG, PNG, BMP, GIF
                    </div>
                  </div>
                  <div class="col-md-4">
                    <button type="submit" class="btn btn-custom w-100">
                      <i class="bi bi-upload me-1"></i>üì§ –ó–∞–≥—Ä—É–∑–∏—Ç—å
                    </button>
                  </div>
                </div>
                <div class="progress mt-3" id="sourceUploadProgress" style="display: none;">
                  <div class="progress-bar progress-bar-striped progress-bar-animated" 
                       role="progressbar" style="width: 0%;" aria-valuenow="0" aria-valuemin="0" aria-valuemax="100">
                    –ó–∞–≥—Ä—É–∑–∫–∞...
                  </div>
                </div>
              </form>
            </div>
          </div>

          <!-- Files List -->
          <div class="card">
            <div class="card-header d-flex justify-content-between align-items-center">
              <h6 class="mb-0">
                <i class="bi bi-files me-2"></i>üìã –°–ø–∏—Å–æ–∫ –∏—Å—Ç–æ—á–Ω–∏–∫–æ–≤
              </h6>
              <div class="d-flex gap-2">
                <small class="text-muted" id="sourceFileCount">0 —Ñ–∞–π–ª–æ–≤</small>
                <button id="refreshSourcesBtn" class="btn btn-outline-primary btn-sm">
                  <i class="bi bi-arrow-clockwise me-1"></i>üîÑ –û–±–Ω–æ–≤–∏—Ç—å
                </button>
              </div>
            </div>
            <div class="card-body">
              <div class="table-responsive">
                <table class="table table-hover" id="sourceTable">
                  <thead class="table-light">
                    <tr>
                      <th scope="col" style="width: 60px;">
                        <i class="bi bi-file-earmark me-1"></i>üìÑ
                      </th>
                      <th scope="col">–ò–º—è —Ñ–∞–π–ª–∞</th>
                      <th scope="col" style="width: 100px;">–¢–∏–ø</th>
                      <th scope="col" style="width: 120px;">–†–∞–∑–º–µ—Ä</th>
                      <th scope="col" style="width: 160px;">–î–µ–π—Å—Ç–≤–∏—è</th>
                    </tr>
                  </thead>
                  <tbody></tbody>
                </table>
              </div>

              <!-- Empty State -->
              <div id="emptySourcesState" class="text-center py-5 text-muted d-none">
                <i class="bi bi-folder-x fs-1"></i>
                <h6 class="mt-3">üìÇ –ò—Å—Ç–æ—á–Ω–∏–∫–∏ –Ω–µ –Ω–∞–π–¥–µ–Ω—ã</h6>
                <p>–ó–∞–≥—Ä—É–∑–∏—Ç–µ –º–µ–¥–∏–∞—Ñ–∞–π–ª—ã –¥–ª—è —Å–æ–∑–¥–∞–Ω–∏—è –∏—Å—Ç–æ—á–Ω–∏–∫–æ–≤</p>
              </div>
            </div>
          </div>
        </div>
        <div class="modal-footer">
          <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">
            <i class="bi bi-x me-1"></i>‚ùå –ó–∞–∫—Ä—ã—Ç—å
          </button>
        </div>
      </div>
    </div>
  </div>

  <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/socket.io/4.6.1/socket.io.min.js"></script>
  <script src="https://cdn.plot.ly/plotly-2.27.0.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
  <script src="/static/js/main.js"></script>
</body>
</html>